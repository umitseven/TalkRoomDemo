@using TalkRoomDemo.DtoLayer.Dtos
@model FriendChatDto
@{ 
    Layout = "_HomeLayout";
}
<div id="chatPopup" class="chat-popup collapsed">
    <div class="chat-header2" id="chatHeader">
        <img src="@Model.FriendImageUrl" alt="Profil" class="profile-pic">
        <div class="user-info">
            <h2>@Model.FriendName</h2>
            <span class="status @(Model.IsOnline ? "online" : "offline")"></span>
        </div>
        <button id="toggleChat" class="toggle-btn">▲</button>
    </div>

    <div class="chat-body">
        <ul id="messagesList" style="list-style: none; padding: 0; margin: 0; max-height: 400px; overflow-y: auto;">
            <!-- Mesajlar JS ile buraya eklenecek -->
        </ul>
    </div>

    <div class="chat-footer" style="display: flex; gap: 10px; margin-top: 10px;">
        <input type="hidden" id="currentUserId" value="@Model.UserId" /> <!-- Oturum açan kullanıcının ID'si -->
        <input type="hidden" id="friendUserId" value="@Model.FriendId" /> <!-- Mesaj gönderilen arkadaşın ID'si -->
        <input type="text" id="messageInput" placeholder="Mesaj yaz…" style="flex: 1; padding: 8px;" />
        <button type="button" id="sendButton" style="padding: 8px 16px;">Gönder</button>
    </div>

</div>
<style>
    /* Genel popup alanı */
    .chat-popup {
        position: fixed;
        bottom: 0;
        right: 13%;
        width: 340px;
        background: #2f3136;
        border-radius: 10px 10px 0 0;
        box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        display: flex;
        flex-direction: column;
        font-family: "Segoe UI", sans-serif;
        color: #dcddde;
        transition: height 0.3s ease, transform 0.3s ease;
        z-index: 100;
    }

        /* Kapalı görünüm */
        .chat-popup.collapsed {
            height: 50px;
            overflow: hidden;
            position: fixed;
            bottom: 0;
            width: 10%;
            right: 13%;
            z-index: 100;
        }

    /* Başlık (kullanıcı adı + durum + buton) */
    .chat-header2 {
        background: #202225;
        padding: 8px 12px;
        display: flex;
        align-items: center;
        border-radius: 10px 10px 0 0;
        cursor: pointer;
    }

        .chat-header2 img.profile-pic {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .chat-header2 .user-info {
            flex: 1;
        }

            .chat-header2 .user-info h2 {
                margin: 0;
                font-size: 15px;
                font-weight: 600;
                color: #fff;
            }

        .chat-header2 .status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 6px;
        }

            .chat-header2 .status.online {
                background: #43b581; /* Yeşil */
            }

            .chat-header2 .status.offline {
                background: #747f8d; /* Gri */
            }

    /* Aç / kapat butonu */
    .toggle-btn {
        background: transparent;
        border: none;
        color: #b9bbbe;
        font-size: 14px;
        cursor: pointer;
    }

    /* Mesaj gövdesi */
    .chat-body {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        background: #2f3136;
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 300px;
    }

        /* Her mesaj balonu */
        .chat-body .message {
            padding: 6px 10px;
            border-radius: 6px;
            max-width: 80%;
            font-size: 14px;
            line-height: 1.4;
            word-break: break-word;
        }

            .chat-body .message.sent {
                align-self: flex-end;
                background: #5865f2; /* Discord mavisi */
                color: #fff;
            }

            .chat-body .message.received {
                align-self: flex-start;
                background: #40444b;
                color: #dcddde;
            }

    /* Alt kısım (mesaj inputu + buton) */
    .chat-footer {
        display: flex;
        padding: 8px;
        background: #40444b;
        border-top: 1px solid #202225;
        border-radius: 0 0 10px 10px;
    }

        .chat-footer input {
            flex: 1;
            background: #303339;
            border: none;
            border-radius: 5px;
            padding: 8px;
            color: #fff;
            font-size: 14px;
        }

            .chat-footer input:focus {
                outline: none;
                background: #3a3d43;
            }

        .chat-footer button {
            margin-left: 8px;
            background: #5865f2;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            color: #fff;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
        }

            .chat-footer button:hover {
                background: #4752c4;
            }



    #chatInput {
        flex-grow: 1;
        border: none;
        padding: 8px;
        border-radius: 4px;
        outline: none;
        font-size: 14px;
    }

    #sendBtn {
        margin-left: 8px;
        background-color: #5865f2;
        border: none;
        color: #fff;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s;
    }

        #sendBtn:hover {
            background-color: #4752c4;
        }

   

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.8/signalr.min.js"></script>
    <script src="~/js/signalr/dist/browser/signalr.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="~/js/chat.js"></script>
<script>
    document.getElementById("toggleChat").addEventListener("click", function () {
        document.getElementById("chatPopup").classList.toggle("collapsed");
        this.textContent = document.getElementById("chatPopup").classList.contains("collapsed") ? "▲" : "▼";
    });
    window.friendId = @Model.FriendId; // Arkadaşın ID'si
</script>
